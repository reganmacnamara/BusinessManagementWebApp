@page "/clients"
@using InvoiceAutomationWebApp.Data
@using InvoiceAutomationWebApp.Data.Clients
@using System.Threading.Tasks
@using InvoiceAutomationWebApp.Data.Clients.Entities
@rendermode InteractiveServer

@inject ApiClient api
@inject NavigationManager NavigationManager

<PageTitle>Clients</PageTitle>

<div class="d-flex">
    <div class="mr-auto p-2">
        <h1>Clients</h1>
    </div>

    <div class="p-2">
        <MudFab Color="Color.Success"
                OnClick="NavigateToCreateClient"
                StartIcon="@Icons.Material.Filled.Add" />

        <MudFab Color="Color.Error"
                StartIcon="@Icons.Material.Filled.Delete" />
    </div>
</div>

<MudTable Breakpoint="Breakpoint.Sm"
          Items="@clients"
          Hover="true"
          Loading="@loading"
          LoadingProgressColor="Color.Info"
          OnRowClick="ClientSelected"
          RowClass="cursor-pointer"
          T="Client">
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Phone</MudTh>
        <MudTh>Email</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name">@context.ClientName</MudTd>
        <MudTd DataLabel="Phone">@context.ClientPhone</MudTd>
        <MudTd DataLabel="Email">@context.ClientEmail</MudTd>
    </RowTemplate>
</MudTable>

@code {
    private List<Client> clients = [];
    private bool loading = true;

    private void ClientSelected(TableRowClickEventArgs<Client> args)
    {
        var _SelectedClient = args.Item;

        if (_SelectedClient is not null)
            NavigationManager.NavigateTo($"/clients/{_SelectedClient.ClientID}");
    }

    private void NavigateToCreateClient()
        => NavigationManager.NavigateTo($"/clients/create");

    private async Task GetClients()
    {
        var _Response = await api.GetClientsAsync();

        clients = _Response.Clients ?? [];
    }

    protected override async Task OnInitializedAsync()
    {
        await GetClients();
        loading = false;
    }
}
